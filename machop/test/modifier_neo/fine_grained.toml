# ---------------------------------------
# After modification,
#    - all Conv2d modules will be Conv2dMinifloatSimple (coarse-grained)
#    - all Conv1d, Linear, and ReLLU modules will be default fixed-point, except (coarse-grained)
#    - the layer Resnet18.relu is ReLUMSFP (fine-grained)
# ---------------------------------------
[default]
bias_frac_width = 5
bias_width = 8
data_in_frac_width = 5
data_in_width = 8
name = "integer"
weight_frac_width = 3
weight_width = 8

# -----------------------------------------
# Coarse-grained: Module class replacement
# -----------------------------------------
[module_classes_to_modify.conv1d]
name = "default"

# Use 'minifloat_simple' for all Linear layers
[module_classes_to_modify.conv2d]
bias_exponent_bias = 7
bias_exponent_width = 4
bias_width = 8
data_in_exponent_bias = 7
data_in_exponent_width = 4
data_in_width = 8
name = "minifloat_simple"
weight_exponent_bias = 7
weight_exponent_width = 4
weight_width = 8

[module_classes_to_modify.linear]
name = "default"

[module_classes_to_modify.relu]
name = "default"

# -----------------------------------------
# Coarse-grained: function replacement
# -----------------------------------------
[functions_to_modify.add]
name = "default"

[functions_to_modify.bmm]
name = "default"

[functions_to_modify.matmul]
name = "default"

[functions_to_modify.relu]
name = "default"

# -----------------------------------------
# Coarse-grained: Method replacement
# -----------------------------------------
[methods_to_modify.add]
name = "default"

[methods_to_modify.bmm]
name = "default"

[methods_to_modify.matmul]
name = "default"

[methods_to_modify.relu]
name = "default"

# -----------------------------------------
# Fine-grained: Layer replacement
# 'xxx' in `modules_to_modify.xxx` is node.target
# -----------------------------------------
[modules_to_modify.conv1]
name = "default"

# [modules_to_modify.bn1]
# name = "default"

# Use MSFP for this relu layer (this is the last relu layer in resnet18)
[modules_to_modify.relu]
data_in_block_size = [1, 16]
data_in_exponent_bias = 127
data_in_exponent_width = 8
data_in_width = 4
name = "msfp"

# [modules_to_modify.maxpool]
# name = "default"

[modules_to_modify."layer1.0.conv1"]
name = "default"

# [modules_to_modify."layer1.0.bn1"]
# name = "default"

[modules_to_modify."layer1.0.relu"]
name = "default"

[modules_to_modify."layer1.0.conv2"]
name = "default"

# [modules_to_modify."layer1.0.bn2"]
# name = "default"

[modules_to_modify."layer1.1.conv1"]
name = "default"

# [modules_to_modify."layer1.1.bn1"]
# name = "default"

[modules_to_modify."layer1.1.relu"]
name = "default"

[modules_to_modify."layer1.1.conv2"]
name = "default"

# [modules_to_modify."layer1.1.bn2"]
# name = "default"

[modules_to_modify."layer2.0.conv1"]
name = "default"

# [modules_to_modify."layer2.0.bn1"]
# name = "default"

[modules_to_modify."layer2.0.relu"]
name = "default"

[modules_to_modify."layer2.0.conv2"]
name = "default"

# [modules_to_modify."layer2.0.bn2"]
# name = "default"

# [modules_to_modify."layer2.0.downsample.0"]
# name = "default"

# [modules_to_modify."layer2.0.downsample.1"]
# name = "default"

[modules_to_modify."layer2.1.conv1"]
name = "default"

# [modules_to_modify."layer2.1.bn1"]
# name = "default"

[modules_to_modify."layer2.1.relu"]
name = "default"

[modules_to_modify."layer2.1.conv2"]
name = "default"

# [modules_to_modify."layer2.1.bn2"]
# name = "default"

[modules_to_modify."layer3.0.conv1"]
name = "default"

# [modules_to_modify."layer3.0.bn1"]
# name = "default"

[modules_to_modify."layer3.0.relu"]
name = "default"

[modules_to_modify."layer3.0.conv2"]
name = "default"

# [modules_to_modify."layer3.0.bn2"]
# name = "default"

# [modules_to_modify."layer3.0.downsample.0"]
# name = "default"

# [modules_to_modify."layer3.0.downsample.1"]
# name = "default"

[modules_to_modify."layer3.1.conv1"]
name = "default"

# [modules_to_modify."layer3.1.bn1"]
# name = "default"

[modules_to_modify."layer3.1.relu"]
name = "default"

[modules_to_modify."layer3.1.conv2"]
name = "default"

# [modules_to_modify."layer3.1.bn2"]
# name = "default"

[modules_to_modify."layer4.0.conv1"]
name = "default"

# [modules_to_modify."layer4.0.bn1"]
# name = "default"

[modules_to_modify."layer4.0.relu"]
name = "default"

[modules_to_modify."layer4.0.conv2"]
name = "default"

# [modules_to_modify."layer4.0.bn2"]
# name = "default"

# [modules_to_modify."layer4.0.downsample.0"]
# name = "default"

# [modules_to_modify."layer4.0.downsample.1"]
# name = "default"

[modules_to_modify."layer4.1.conv1"]
name = "default"

# [modules_to_modify."layer4.1.bn1"]
# name = "default"

[modules_to_modify."layer4.1.relu"]
name = "default"

[modules_to_modify."layer4.1.conv2"]
name = "default"

# [modules_to_modify."layer4.1.bn2"]
# name = "default"

# [modules_to_modify.avgpool]
# name = "default"

[modules_to_modify.fc]
name = "default"
